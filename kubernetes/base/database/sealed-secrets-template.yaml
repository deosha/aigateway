# =============================================================================
# Sealed Secrets Template for PostgreSQL
# =============================================================================
# This template shows how to create a SealedSecret for production use.
#
# Prerequisites:
#   1. Install Sealed Secrets controller:
#      kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml
#
#   2. Install kubeseal CLI:
#      brew install kubeseal  # macOS
#      # or download from https://github.com/bitnami-labs/sealed-secrets/releases
#
# Usage:
#   1. Create a regular secret file (do NOT commit this):
#
#      cat > /tmp/postgresql-secret.yaml <<EOF
#      apiVersion: v1
#      kind: Secret
#      metadata:
#        name: postgresql-secrets
#        namespace: database
#      type: Opaque
#      stringData:
#        postgres-password: "$(openssl rand -base64 32)"
#        litellm-password: "$(openssl rand -base64 32)"
#        replication-password: "$(openssl rand -base64 32)"
#      EOF
#
#   2. Seal the secret:
#      kubeseal --format yaml < /tmp/postgresql-secret.yaml > kubernetes/overlays/production/sealed-postgresql-secrets.yaml
#
#   3. Delete the plaintext secret:
#      rm /tmp/postgresql-secret.yaml
#
#   4. Apply the sealed secret:
#      kubectl apply -f kubernetes/overlays/production/sealed-postgresql-secrets.yaml
#
# The sealed secret will look like this (example - values are encrypted):
# =============================================================================
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: postgresql-secrets
  namespace: database
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "false"
spec:
  encryptedData:
    # These values are encrypted and can only be decrypted by the cluster
    # DO NOT use these example values - generate your own using kubeseal
    postgres-password: AgA...encrypted...base64...==
    litellm-password: AgB...encrypted...base64...==
    replication-password: AgC...encrypted...base64...==
  template:
    metadata:
      name: postgresql-secrets
      namespace: database
    type: Opaque
---
# =============================================================================
# Alternative: External Secrets Operator
# =============================================================================
# If using External Secrets Operator with AWS Secrets Manager:
#
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: postgresql-secrets
#   namespace: database
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: ClusterSecretStore
#   target:
#     name: postgresql-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: postgres-password
#       remoteRef:
#         key: ai-gateway/database/postgres-password
#     - secretKey: litellm-password
#       remoteRef:
#         key: ai-gateway/database/litellm-password
#     - secretKey: replication-password
#       remoteRef:
#         key: ai-gateway/database/replication-password

admin:
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 9901

static_resources:
  listeners:
    # Port 9000: LLM Gateway (proxy to LiteLLM)
    - name: llm_gateway
      address:
        socket_address:
          address: 0.0.0.0
          port_value: 9000
      filter_chains:
        - filters:
            - name: envoy.filters.network.http_connection_manager
              typed_config:
                "@type": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
                stat_prefix: llm_gateway
                route_config:
                  name: llm_routes
                  virtual_hosts:
                    - name: litellm
                      domains: ["*"]
                      routes:
                        - match:
                            prefix: "/"
                          route:
                            cluster: litellm_cluster
                http_filters:
                  - name: envoy.filters.http.router
                    typed_config:
                      "@type": type.googleapis.com/envoy.extensions.filters.http.router.v3.Router

    # Port 9001: MCP Gateway (aggregates MCP servers)
    - name: mcp_gateway
      address:
        socket_address:
          address: 0.0.0.0
          port_value: 9001
      filter_chains:
        - filters:
            - name: envoy.filters.network.http_connection_manager
              typed_config:
                "@type": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
                stat_prefix: mcp_gateway
                route_config:
                  name: mcp_routes
                  virtual_hosts:
                    - name: mcp_servers
                      domains: ["*"]
                      routes:
                        # Route to filesystem MCP
                        - match:
                            prefix: "/filesystem"
                          route:
                            cluster: mcp_filesystem_cluster
                            prefix_rewrite: "/"
                        # Route to database MCP
                        - match:
                            prefix: "/database"
                          route:
                            cluster: mcp_database_cluster
                            prefix_rewrite: "/"
                        # Route to brave search MCP
                        - match:
                            prefix: "/brave-search"
                          route:
                            cluster: mcp_brave_cluster
                            prefix_rewrite: "/"
                        # Route to github MCP
                        - match:
                            prefix: "/github"
                          route:
                            cluster: mcp_github_cluster
                            prefix_rewrite: "/"
                        # Health check
                        - match:
                            prefix: "/health"
                          direct_response:
                            status: 200
                            body:
                              inline_string: '{"status":"healthy","service":"mcp-gateway"}'
                http_filters:
                  - name: envoy.filters.http.router
                    typed_config:
                      "@type": type.googleapis.com/envoy.extensions.filters.http.router.v3.Router

  clusters:
    # LiteLLM cluster
    - name: litellm_cluster
      connect_timeout: 5s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: litellm_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: litellm
                      port_value: 4000
      health_checks:
        - timeout: 1s
          interval: 10s
          unhealthy_threshold: 2
          healthy_threshold: 2
          http_health_check:
            path: "/health"

    # MCP Filesystem cluster
    - name: mcp_filesystem_cluster
      connect_timeout: 5s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: mcp_filesystem_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: mcp-filesystem
                      port_value: 3000

    # MCP Database cluster
    - name: mcp_database_cluster
      connect_timeout: 5s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: mcp_database_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: mcp-database
                      port_value: 3000

    # MCP Brave Search cluster
    - name: mcp_brave_cluster
      connect_timeout: 5s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: mcp_brave_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: mcp-brave-search
                      port_value: 3000

    # MCP GitHub cluster
    - name: mcp_github_cluster
      connect_timeout: 5s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: mcp_github_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: mcp-github
                      port_value: 3000
